@page
@model FinalProject.Areas.EmailSystem.Pages.ComposeMailModel
@{
    ViewData["Title"] = "Compose Mail";
    var receiver = Request.Query["Receiver"];
    var subject = Request.Query["Subject"];
    var successMessage = TempData["SuccessMessage"] as string; // ดึงข้อความจาก TempData
}

<h1 class="text-center my-4">Compose an Email</h1>

<div class="container">
    <!-- แสดงข้อความแจ้งเตือนหากมี -->
    @if (!string.IsNullOrEmpty(successMessage))
    {
        <div class="alert alert-success" id="successMessage">
            @successMessage
        </div>
    }

    <form method="post" class="p-4 bg-light shadow rounded">
        <!-- แสดงข้อความแจ้งเตือนจาก ModelState -->
        <div asp-validation-summary="All" class="text-danger mb-3"></div>

        <div class="mb-3">
            <label for="receiver" class="form-label text-black">Receiver</label>
            <input name="Receiver" type="text" id="receiver" class="form-control" value="@receiver" placeholder="Enter recipient's email" />
        </div>

        <div class="mb-3">
            <label for="subject" class="form-label text-black">Subject</label>
            <input name="Subject" type="text" id="subject" class="form-control" value="@subject" placeholder="Enter email subject" />
        </div>

        <div class="mb-3">
            <label for="body" class="form-label text-black">Body</label>
            <textarea id="body" name="Body" class="form-control" rows="6" placeholder="Type your message here..."></textarea>
        </div>

        <button type="submit" class="btn btn-primary w-100">Send</button>
    </form>
</div>

@if (!string.IsNullOrEmpty(successMessage))
{
    <script>
        // แสดงข้อความแจ้งเตือนทันทีหลังจากส่งอีเมลสำเร็จ
        document.addEventListener("DOMContentLoaded", function () {
            var successMessage = document.getElementById('successMessage');
            if (successMessage) {
                successMessage.style.display = 'block';
            }
        });
    </script>
}
